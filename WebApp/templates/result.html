{% extends "base.html" %}

{% block content %}
<h2 class="text-xl font-bold mb-4">Wind Energy Balance</h2>

{% if error %}
    <p class="text-red-600">{{ error }}</p>
{% else %}
    <p class="mb-4">Turbine: <strong>{{ turbine.name }}</strong> ({{ turbine.company_name }})</p>
    <p class="mb-4">Average Daily Balance: <strong>{{ average_output|floatformat:2 }} W</strong></p>
    <p class="mb-4">Sum of produced energy: <strong>{{ produced_energy|floatformat:2 }} W</strong></p>


    <canvas id="powerChart" width="100%" height="40"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const rawData = {{ chart_data|safe }};
      const labels = rawData.labels;
      const data = rawData.data;

      // Generate background colors based on sign of the data
      const backgroundColors = data.map(value => value >= 0 ? 'rgba(75, 192, 192, 0.6)' : 'rgba(255, 99, 132, 0.6)');
      const borderColors = data.map(value => value >= 0 ? 'rgb(75, 192, 192)' : 'rgb(255, 99, 132)');

      const ctx = document.getElementById('powerChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Daily Power Balance (W)',
            data: data,
            backgroundColor: backgroundColors,
            borderColor: borderColors,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: {
              title: {
                display: true,
                text: 'Date'
              },
              ticks: {
                maxRotation: 90,
                minRotation: 45,
                autoSkip: true,
                maxTicksLimit: 20
              }
            },
            y: {
              title: {
                display: true,
                text: 'Power Balance (W)'
              },
              beginAtZero: true
            }
          }
        }
      });
    </script>
{% endif %}
{% endblock %}
